# 串口通信协议说明

## 协议格式
```
帧头(1字节) + 命令(1字节) + 数据长度(1字节) + 数据(N字节) + 校验和(1字节)
```

## 字段说明
- **发送帧头**: 固定值 0x01 (主机发送给设备)
- **响应帧头**: 固定值 0x06 (设备响应给主机)
- **命令**: 0xD7、0xDA、0xDD 或 0xA2
- **数据长度**: 数据字段的字节数 (0-64)
- **数据**: 具体的数据内容
- **校验和**: 所有前面字节的累加和

## 命令定义

### 0xD7 - 设置开关/亮度
**数据格式**: 1字节
- 0x00: 关闭灯
- 0x01-0x64: 打开灯并设置亮度 (1-100%)

**示例**:
```
关闭灯: 01 D7 01 00 D8
响应: 06 D7 01 00 DD

打开灯50%亮度: 01 D7 01 32 0A
响应: 06 D7 01 32 0F
```

### 0xDA - 设置色温
**数据格式**: 1字节
- 0x01-0x3D: 色温索引 (1-61)

**说明**: 
- 进入纯色显示模式，无动画效果
- 色温索引对应固定的RGB值
- 支持亮度调节

**示例**:
```
设置色温索引20: 01 DA 01 14 0F
响应: 06 DA 01 14 14
```

### 0xDD - 设置动态场景
**数据格式**: 1字节
- 0x00-0x1E: 场景编号 (0-30)

**示例**:
```
设置场景5: 01 DD 01 05 0F
响应: 06 DD 01 05 13
```

### 0xA2 - 查询灯运行状态
**数据格式**: 无数据
**响应**: 5字节状态信息
- 字节1: 开关状态 (0x00:关闭, 0x01:打开)
- 字节2: 当前亮度 (0-100)
- 字节3: 当前色温索引 (1-61)
- 字节4: 当前场景 (0-30)
- 字节5: 当前模式/动画效果 (0-4:动画效果, 0xFF:色温模式)

**示例**:
```
查询状态: 01 A2 00 A3
响应: 06 A2 05 01 32 14 05 02 0F
```

## 校验和计算
校验和 = 帧头 + 命令 + 数据长度 + 所有数据字节的累加和

## 使用示例

### 关闭灯
```
发送: 01 D7 01 00 D8
解析:
- 帧头: 01
- 命令: D7
- 长度: 01
- 数据: 00 (关闭)
- 校验: D8 (01+D7+01+00 = D8)

响应: 06 D7 01 00 DD
解析:
- 帧头: 06 (响应帧头)
- 命令: D7
- 长度: 01
- 数据: 00 (确认关闭)
- 校验: DD (06+D7+01+00 = DD)
```

### 打开灯并设置50%亮度
```
发送: 01 D7 01 32 0A
解析:
- 帧头: 01
- 命令: D7
- 长度: 01
- 数据: 32 (50%亮度)
- 校验: 0A (01+D7+01+32 = 0A)

响应: 06 D7 01 32 0F
解析:
- 帧头: 06 (响应帧头)
- 命令: D7
- 长度: 01
- 数据: 32 (确认亮度)
- 校验: 0F (06+D7+01+32 = 0F)
```

### 设置色温索引20
```
发送: 01 DA 01 14 0F
解析:
- 帧头: 01
- 命令: DA
- 长度: 01
- 数据: 14 (色温索引20)
- 校验: 0F (01+DA+01+14 = 0F)

响应: 06 DA 01 14 14
解析:
- 帧头: 06 (响应帧头)
- 命令: DA
- 长度: 01
- 数据: 14 (确认色温)
- 校验: 14 (06+DA+01+14 = 14)
```

### 设置场景5
```
发送: 01 DD 01 05 0F
解析:
- 帧头: 01
- 命令: DD
- 长度: 01
- 数据: 05 (场景5)
- 校验: 0F (01+DD+01+05 = 0F)

响应: 06 DD 01 05 13
解析:
- 帧头: 06 (响应帧头)
- 命令: DD
- 长度: 01
- 数据: 05 (确认场景)
- 校验: 13 (06+DD+01+05 = 13)
```

### 查询灯运行状态
```
发送: 01 A2 00 A3
解析:
- 帧头: 01
- 命令: A2
- 长度: 00
- 数据: 无
- 校验: A3 (01+A2+00 = A3)

响应: 06 A2 05 01 32 14 05 02 0F
解析:
- 帧头: 06 (响应帧头)
- 命令: A2
- 长度: 05
- 数据: 01 32 14 05 02 (开关:开, 亮度:50%, 色温:20, 场景:5, 模式:动画2)
- 校验: 0F (06+A2+05+01+32+14+05+02 = 0F)
```

## 注意事项
1. 波特率: 9600
2. 数据位: 8
3. 停止位: 1
4. 无奇偶校验
5. 超时时间: 1秒
6. 最大数据长度: 64字节 